
# Main technologies of architecture

## Architecture Overview

![IoT Event Streaming Architecture](https://miro.medium.com/v2/resize:fit:2000/format:webp/1*IUaBLlbVKgmsjbjqzew0ZQ.png)

## Eclipse Mosquitto

**Eclipse Mosquitto** เป็นซอฟต์แวร์โอเพ่นซอร์สที่ทำหน้าที่เป็น MQTT broker ซึ่งเป็นโปรโตคอลที่ใช้ในการสื่อสารระหว่างอุปกรณ์ IoT ด้วยการออกแบบที่มีประสิทธิภาพและใช้ทรัพยากรน้อย ทำให้ Eclipse Mosquitto เหมาะสำหรับงานที่เกี่ยวกับ IoT โดยมีคุณสมบัติหลักดังนี้
- **โอเพ่นซอร์ส** ดาวน์โหลดและใช้งานได้ฟรี รวมถึงแก้ไขซอฟต์แวร์ได้ตามต้องการ
- **รองรับ MQTT** ทำหน้าที่เป็นตัวกลางในการส่งและรับข้อความระหว่างอุปกรณ์
- **ติดตั้งง่าย** รองรับหลายระบบปฏิบัติการ เช่น Windows, macOS, และ Linux
- **ความปลอดภัย** รองรับการเข้ารหัส SSL/TLS และการตรวจสอบสิทธิ์ของผู้ใช้

## Apache ZooKeeper

**Apache Zookeeper** เป็นระบบจัดการและประสานงานแบบกระจาย (distributed coordination service) โดยใช้ในระบบที่มีความซับซ้อนและต้องการความเสถียรสูง เช่น Apache Kafka, Hadoop, และ Hbase 

หน้าที่และคุณสมบัติสำคัญของ ZooKeeper ได้แก่
- จัดการ brokers และบันทึกสถานะของ brokers แต่ละตัว
- บันทึกข้อมูลเกี่ยวกับ topics และ partitions
- เลือก leader/replica ของ partitions
- แจ้งเตือน Kafka เมื่อมีการเปลี่ยนแปลง เช่น broker ใหม่หรือตาย
- บันทึกการเขียน/อ่านข้อมูลของ producers และ consumers
- เก็บข้อมูล Authorization สำหรับการสร้าง topics
- ติดตาม offset ของ consumer groups

## Apache Kafka

**Apache Kafka** คือระบบจัดคิวข้อความแบบกระจาย (distributed message queue) ที่สามารถรับส่งข้อมูลในปริมาณมากได้อย่างมีประสิทธิภาพ Kafka เหมาะสำหรับระบบที่ต้องการความสามารถในการส่งข้อมูลระหว่างแอปพลิเคชันหลายตัวในรูปแบบที่เสถียรและปรับขนาดได้

## Apache Kafka Connect

**Kafka Connect** เป็นเครื่องมือที่ทำหน้าที่เชื่อมต่อและแปลงข้อมูลระหว่างระบบต้นทาง (source systems) และระบบปลายทาง (target systems) โดยไม่ต้องสร้าง producer และ consumer ขึ้นมาเอง Kafka Connect ช่วยลดความซับซ้อนในการทำงานกับข้อมูลจำนวนมากที่อยู่ใน Kafka

## Apache Kafka Streams

**Kafka Streams** เป็นไลบรารีที่ใช้สำหรับการประมวลผลข้อมูลใน Kafka โดยสามารถทำการคำนวณและแปลงข้อมูลแบบสตรีมได้อย่างมีประสิทธิภาพ

## Apache Kafka Rest Proxy

**Kafka REST Proxy** เป็นเครื่องมือหรืออินเทอร์เฟซที่ช่วยให้ผู้ใช้สามารถสื่อสารกับ Kafka brokers ผ่าน HTTP API แทนที่จะใช้ Kafka client โดยตรง ซึ่งทำให้การเชื่อมต่อกับ Kafka ง่ายขึ้นสำหรับแอปพลิเคชันหรือบริการที่ไม่รองรับ Kafka client libraries หรือไม่ได้เขียนด้วยภาษาที่ Kafka รองรับโดยตรง
## Prometheus

**Prometheus** เป็นระบบมอนิเตอร์ริ่งและเตือนภัยแบบโอเพ่นซอร์สที่ออกแบบมาเพื่อรวบรวมและจัดเก็บข้อมูลเมตริกในรูปแบบ time series data เหมาะสำหรับการมอนิเตอร์ระบบและแอปพลิเคชันต่าง ๆ โดยมีการทำงานแบบกระจายและมีความยืดหยุ่นสูง Prometheus สามารถทำงานร่วมกับ Grafana เพื่อสร้างกราฟแสดงข้อมูลแบบเรียลไทม์

## MongoDB

**MongoDB** เป็นฐานข้อมูล NoSQL ที่ได้รับความนิยมซึ่งออกแบบมาให้จัดเก็บข้อมูลในรูปแบบที่ยืดหยุ่น MongoDB เหมาะสำหรับการจัดการข้อมูลปริมาณมาก โดยนักพัฒนาสามารถปรับแต่งการทำงานของระบบเพื่อสร้างแอปพลิเคชันที่ทันสมัยและขับเคลื่อนด้วยข้อมูลได้อย่างง่ายดาย

## Grafana

**Grafana** เป็นเครื่องมือสร้างแดชบอร์ดที่สามารถแสดงข้อมูลจากเมตริกต่าง ๆ ในรูปแบบกราฟแบบเรียลไทม์ Grafana รองรับการดึงข้อมูลจากแหล่งข้อมูลยอดนิยม เช่น Prometheus, InfluxDB, Elasticsearch, AWS CloudWatch เป็นต้น 

จุดเด่นของ Grafana คือ
- **การมอนิเตอร์เมตริกแบบเรียลไทม์** สามารถดู CPU, Memory และเมตริกอื่น ๆ ได้ทันที
- **การแจ้งเตือน** รองรับการแจ้งเตือนผ่าน Email, Slack, Line และช่องทางอื่น ๆ
- **ความยืดหยุ่นสูง** มีตัวเลือกในการปรับแต่งกราฟและแผงควบคุม (panels) อย่างหลากหลาย
- **รองรับหลาย Data Sources** สามารถใช้งานกับแหล่งข้อมูลหลายประเภทพร้อมกันได้

## IoT Processor

**IoT Processor** เป็นการประมวลผลข้อมูลที่ได้จากเซ็นเซอร์ ข้อมูลที่เก็บมาอาจจะถูกส่งไปยังระบบประมวลผลหรือเซิร์ฟเวอร์กลาง การประมวลผลอาจรวมถึง

- การคำนวณ: เช่นการคำนวณค่าเฉลี่ย หรือค่าความผันแปรของข้อมูล
- การแปลงข้อมูล: เช่น การแปลงหน่วยข้อมูลที่ได้จากเซ็นเซอร์
- การจัดส่งข้อมูล: ส่งข้อมูลไปยัง MQTT broker เพื่อนำไปแสดงผลบน Grafana หรือเก็บในฐานข้อมูล
## IoT Sensor
ในโปรเจคนี้เรามี IoT Sensor 2 รูปแบบคือ 
* ข้อมูล IoT Sensor จาก hardware (Cucumber)
* ข้อมูล IoT Sensor จาก ไมโครเซอร์วิส ที่จำลองจาก Container 
### Cucumber  
IoT Sensor เป็นโมดูลเซ็นเซอร์หรือฟังก์ชันที่เกี่ยวกับการรวบรวมข้อมูลจากเซ็นเซอร์ต่างๆบนอุปกรณ์ hardware รวมถึงการอ่านค่าในระบบ IoT ตัวอย่างเช่น

- อุณหภูมิ: การรวบรวมอุณหภูมิจากเซ็นเซอร์อุณหภูมิ เช่น DHT11, BMP280
- ความชื้น: การเก็บค่าความชื้นในอากาศ
- แสง: การเก็บข้อมูลความเข้มของแสงจาก LDR ที่ทำการต่อเพิ่ม(cucumberไม่มีbuilt-in)
- ความกดอากาศ: atm

### IoT Sensor container
IoT Sensor เป็น sensor ที่ถูกจําลองด้วยไมโครเซอร์วิสที่ใช้ใน Spring Boot (ผ่านไลบรารี Eclipse Paho MQTT) ที่ถูกติดตั้งอยู่บนเซิฟเวอร์ โดยจะส่งข้อมูล telemetry ไปยังโบรกเกอร์ Eclipse Mosquitto ข้อมูลที่ถูกจำลองนี้ generate ค่า ทุกอย่างภายใน payload มาจาก Callable โดยจะถูกสร้างขึ้นทุกวินาทีและ มี payload ในรูปแบบที่สร้างขึ้นให้ตรงกัน

